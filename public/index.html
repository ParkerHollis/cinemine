<html>
  <head>
  <title>Cinemine</title>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <style>
html,body{
  	height:100%;
}

body{
  	padding-top:50px; /*padding for navbar*/
}

.navbar-custom .icon-bar {
	background-color:#fff;
}

.navbar-custom {
	background-color: #168ccc;
    color:#fff;
}

.navbar-custom li>a:hover,.navbar-custom li>a:focus {
	background-color:#49bfff;
}

.navbar-custom a{
    color:#fefefe;
}

.navbar-custom .form-control:focus {
	border-color: #49bfff;
	outline: 0;
	-webkit-box-shadow: inset 0 0 0;
	box-shadow: inset 0 0 0;
}

#main, #main>.row {
	height:100%;
}

#main>.row {
    overflow-y:scroll;
}

#left {
	height:100%;
}
  </style>
  </head>
  <body>
  <div class="container">
	<div class="navbar navbar-custom navbar-fixed-top">
		<div class="navbar-header"><a class="navbar-brand" href="#">Node Manager</a>
		</div>
    </div><br>
	<div id="probes" class="container">
	<div id="row">
	<div class="col-md-3"><div class="well"><h2 style="margin-top:0px; text-align:center; font-size:24px; font-weight:bold;">Manager</h2><hr>CPU Usage: <h4 id="ManagerCPU">Connecting...</h4>RAM Usage: <h4 id="ManagerRAM">Connecting...</h4></div></div>
    <script>
      var socket = io();
      socket.on('IPList', function(msg){
        var IPList = msg;
        IPList.forEach(function(item) {
		  var address = item.split("|")[0];
		  var friendlyName = item.split("|")[1];
		  $('#probes').append('<div class="col-md-3"><div class="well"><h2 style="margin-top:0px; text-align:center; font-size:24px; font-weight:bold;">'+friendlyName+'</h2><hr>CPU Usage: <h4 id="'+friendlyName+'CPU">Connecting...</h4>RAM Usage: <h4 id="'+friendlyName+'RAM">Connecting...</h4></div></div>');
        })
      });

      socket.on('data', function(msg){
        var location = msg.split("|")[0];
        var uptime = msg.split("|")[1];
		var usedMem = msg.split("|")[2];
		var totalMem = msg.split("|")[3];
		var usedCPU = msg.split("|")[4];
		var freeCPU = 100-(usedCPU);
		var freeMem = totalMem-usedMem;
		convertTime(uptime);
		updateDiv(location, usedCPU, 'CPU', '%');
		updateDiv(location, usedMem, 'RAM', 'MB');
      });
    </script>
	</div>
	</div>
  <script>
  function convertTime(seconds) {
	ms = seconds*1000;
	days = Math.floor(ms / 86400000);
	hours = Math.floor(ms / 3600000) - (days*24);
	minutes = Math.floor((ms % 3600000) / 60000);
	sec = Math.floor(((ms % 360000) % 60000) / 1000);
  }
	
  function updateDiv(location, data, type, unit) {
	var destination = '#'+location+type;
	var text = data+'<small>'+unit+'</small>';
	$(destination).html(text);
  }
  </script>
  </div>
  </body>
</html>